<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Twitter-Search</title>
<link rel="stylesheet" href="css/style.css">
<style>
/* TwitterSearch ç‰¹å®šæ¨£å¼ */
table { border-collapse: collapse; width: 100%; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background-color: #f0f0f0; }

.btn-group { display: flex; justify-content: center; flex-wrap: wrap; gap: 2px; }
.btn-group button { 
  font-family: monospace;
  font-size: 14px; 
  padding: 5px 10px; 
  border-radius: 6px; 
  border: 1px solid #ccc; 
  cursor: pointer;
}
.btn-group button.selected { background-color: #999999; color: white; }

input[type="checkbox"] { width: 18px; height: 18px; accent-color: #999999; }
th input[type="checkbox"] { cursor: pointer; }
</style>
</head>
<body>
<h1>Twitter-Search</h1>
<h2>ğŸ“Œ ä½¿ç”¨èªªæ˜ï¼š
<ul>
  <li>åœ¨ Google Sheet ç¬¬ä¸€æ¬„è²¼ä¸Šé—œéµå­—ï¼Œæ¯åˆ—ä¸€å€‹ï¼Œå¯åŒ…å«é‹ç®—å­ï¼Œç¨‹å¼æœƒè‡ªå‹•å»æ‰é‹ç®—å­ä½†ä¿ç•™ #ã€‚</li>
  <li>æ‰“é–‹ç¶²é å³å¯è‡ªå‹•è®€å– Sheetï¼Œç”Ÿæˆè¡¨æ ¼åˆ—è¡¨ã€‚</li>
  <li>è¡¨æ ¼å¯å‹¾é¸æ ¸å–æ¡†ã€è¨­å®šæ„›å¿ƒæ•¸ã€æ—¥æœŸç¯„åœå’Œæ’åºï¼Œæ¯åˆ—æœ‰ ğŸ”— å–®åˆ—æœå°‹æŒ‰éˆ•ã€‚</li>
  <li>é»æ“Š ğŸ”— æœå°‹å–®åˆ—ï¼Œæˆ–å‹¾é¸å¤šåˆ—å¾Œé»æ“Š ğŸŒ é–‹å•Ÿå·²é¸æœå°‹ï¼Œç”Ÿæˆå°æ‡‰ Twitter/X æœå°‹é€£çµã€‚</li>
</ul>
</h2>
<table id="searchTable">
  <thead>
    <tr>
      <th><input type="checkbox" id="selectAllCheckbox" checked></th>
      <th>ğŸ”</th>
      <th>
        <div class="btn-group" id="favesHeader">
          <button data-val="any">â¤ï¸</button>
          <button data-val="10" >â¤ï¸10</button>
          <button data-val="100">â¤ï¸100</button>
        </div>
      </th>
      <th>
        <div class="btn-group" id="daysHeader">
          <button data-val="any">ğŸ“…</button>
          <button data-val="1">ğŸ“…1</button>
          <button data-val="7" >ğŸ“…7</button>
          <button data-val="30">ğŸ“…30</button>
        </div>
      </th>
      <th>
        <div class="btn-group" id="sortHeader">
          <button data-val="live" >âœ¨live</button>
          <button data-val="top">ğŸ”¥top</button>
        </div>
      </th>
      <th><button id="openSelected">ğŸŒ</button></th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQj2YzRRSrSV4RK4ESvsTSkizgRNPYjFzZDxMTxn-PGzuhZXxc1y4fIi43geRHgBJPggusWccWucOd8/pub?gid=1669167343&single=true&output=csv";
  const tbody = document.querySelector("#searchTable tbody");
  const selectAllCheckbox = document.getElementById("selectAllCheckbox");

  // å»ºç«‹æŒ‰éˆ•åˆ—å‡½æ•¸
  function createBtnGroup(arr, defaultVal, symbol="â¤ï¸"){
    const td = document.createElement("td");
    const group = document.createElement("div");
    group.className = "btn-group";
    group.dataset.value = defaultVal;

    arr.forEach(val=>{
      const btn = document.createElement("button");
      if(val === "any"){
        btn.textContent = symbol;
        btn.dataset.val = "any";
      } else if(Array.isArray(val)){
        btn.textContent = val[1]+val[0];
        btn.dataset.val = val[0];
      } else {
        btn.textContent = symbol + val;
        btn.dataset.val = val;
      }

      if(Array.isArray(val) && val[0] === defaultVal) btn.classList.add("selected");
      if(val === defaultVal) btn.classList.add("selected");
      btn.addEventListener("click", ()=>{
        group.querySelectorAll("button").forEach(b=>b.classList.remove("selected"));
        btn.classList.add("selected");
        group.dataset.value = btn.dataset.val;
      });

      group.appendChild(btn);
    });

    td.appendChild(group);
    return td;
  }

  // è®€å–è³‡æ–™
  fetch(sheetURL).then(res=>res.text()).then(data=>{
    const lines = data.split('\n').map(l=>l.trim()).filter(Boolean);

    lines.forEach(keyword=>{
      const tr = document.createElement("tr");

      // æ ¸å–æ¡†
      const tdCheck = document.createElement("td");
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = true;
      tdCheck.appendChild(checkbox);
      tr.appendChild(tdCheck);

      // é—œéµå­—
      const tdKeyword = document.createElement("td");
      // å»æ‰æ‹¬è™Ÿå’Œ AND/ORï¼Œä½†ä¿ç•™ #
      const cleanKeyword = keyword
      .replace(/\(|\)/g, "")        // å»æ‰æ‹¬è™Ÿ
      .replace(/\bAND\b|\bOR\b/g, "") // å»æ‰ AND å’Œ OR
      .replace(/\s+/g, " ")          // å¤šç©ºæ ¼åˆä½µ
      .trim();

      tdKeyword.textContent = cleanKeyword;
      tr.appendChild(tdKeyword);
      // æ„›å¿ƒæ•¸
      tr.appendChild(createBtnGroup(["any",10,100],10,"â¤ï¸"));

      // æ—¥æœŸ
      tr.appendChild(createBtnGroup(["any",1,7,30],7,"ğŸ“…"));

      // æ’åº
      tr.appendChild(createBtnGroup([["live","âœ¨"],["top","ğŸ”¥"]], "live", ""));

      // å–®åˆ—æœå°‹
      const tdLink = document.createElement("td");
      const linkBtn = document.createElement("button");
      linkBtn.textContent = "ğŸ”—";
      linkBtn.addEventListener("click", ()=>{
        const faves = tr.cells[2].querySelector(".btn-group").dataset.value;
        const days = tr.cells[3].querySelector(".btn-group").dataset.value;
        const sort = tr.cells[4].querySelector(".btn-group").dataset.value;
        const today = new Date();
        const until = today.toISOString().split("T")[0];
        let sinceDate = "";
        if(days !== "any") {
          sinceDate = new Date(today.getTime()-days*24*60*60*1000).toISOString().split("T")[0];
        }
        let query = keyword;
        if(faves !== "any") query += " min_faves:"+faves;
        let url = `https://x.com/search?q=${encodeURIComponent(query)}`;
        if(sinceDate) url += `%20since%3A${sinceDate}%20until%3A${until}`;
        url += `&src=typed_query&f=${sort}`;
        window.open(url,"_blank");
      });
      tdLink.appendChild(linkBtn);
      tr.appendChild(tdLink);

      tbody.appendChild(tr);
    });
  });

  // è¡¨é ­æ ¸å–æ¡†æ§åˆ¶æ‰€æœ‰åˆ—
  selectAllCheckbox.addEventListener("change", ()=>{
    const checked = selectAllCheckbox.checked;
    document.querySelectorAll("#searchTable tbody tr").forEach(tr=>{
      tr.querySelector("input[type=checkbox]").checked = checked;
    });
  });

  // è¡¨é ­æ„›å¿ƒã€æ—¥æœŸã€æ’åºæ§åˆ¶æ•´æ¬„
  function setupHeaderControl(headerId,colIndex){
    const header = document.getElementById(headerId);
    header.querySelectorAll("button").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        header.querySelectorAll("button").forEach(b=>b.classList.remove("selected"));
        btn.classList.add("selected");
        const val = btn.dataset.val;
        document.querySelectorAll(`#searchTable tbody tr`).forEach(tr=>{
          const g = tr.cells[colIndex].querySelector(".btn-group");
          g.dataset.value = val;
          g.querySelectorAll("button").forEach(b=>{
            b.classList.remove("selected");
            if(b.dataset.val===val) b.classList.add("selected");
          });
        });
      });
    });
  }

  setupHeaderControl("favesHeader",2);
  setupHeaderControl("daysHeader",3);
  setupHeaderControl("sortHeader",4);

  // ğŸŒ é–‹å•Ÿå·²é¸æœå°‹
  document.getElementById("openSelected").addEventListener("click", ()=>{
    document.querySelectorAll("#searchTable tbody tr").forEach(tr=>{
      const cb = tr.querySelector("input[type=checkbox]");
      if(cb.checked){
        const keyword = tr.cells[1].textContent;
        const faves = tr.cells[2].querySelector(".btn-group").dataset.value;
        const days = tr.cells[3].querySelector(".btn-group").dataset.value;
        const sort = tr.cells[4].querySelector(".btn-group").dataset.value;
        const today = new Date();
        const until = today.toISOString().split("T")[0];
        let sinceDate = "";
        if(days !== "any") {
          sinceDate = new Date(today.getTime()-days*24*60*60*1000).toISOString().split("T")[0];
        }
        let query = keyword;
        if(faves !== "any") query += " min_faves:"+faves;
        let url = `https://x.com/search?q=${encodeURIComponent(query)}`;
        if(sinceDate) url += `%20since%3A${sinceDate}%20until%3A${until}`;
        url += `&src=typed_query&f=${sort}`;
        window.open(url,"_blank");
      }
    });
  });

});
</script>
<footer>Â© 2025 Twitter-Search Demo</footer>
</body>
</html>

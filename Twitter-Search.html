<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğ•-Search</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”</text></svg>">
    <style>
        body { font-family: -apple-system, sans-serif; margin: 0; padding: 20px 0; background: #f0f2f5; color: #333; display: flex; justify-content: center; }
        .main-container { width: 95%; max-width: 450px; display: flex; flex-direction: column; }

        /* é ‚éƒ¨æ§åˆ¶æ¬„ */
        .header { position: sticky; top: 0; background: #f0f2f5; padding: 10px 0; z-index: 100; border-bottom: 2px solid #ddd; margin-bottom: 15px; }
        .top-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        
        /* æ™‚é–“ç¯©é¸æŒ‰éˆ•åˆ— (å–ä»£æ¨™é¡Œä½ç½®) */
        .time-group { display: flex; gap: 8px; flex: 1; }
        .btn-time { flex: 1; padding: 8px 5px; font-size: 13px; border-radius: 6px; border: 1px solid #ccc; background: #fff; cursor: pointer; transition: 0.2s; font-weight: bold; }
        .btn-time.active { background: #000; color: #fff; border-color: #000; }

        .button-group { display: flex; gap: 8px; }
        .btn { padding: 8px 12px; font-size: 13px; cursor: pointer; border-radius: 6px; font-weight: bold; border: 1px solid #ccc; transition: 0.2s; }
        
        .btn-primary { background: #63bdf5; color: white; border: none; }
        .btn-primary:hover { background: #1991db; }
        .btn-outline { background: #fff; color: #555; }
        .btn-outline:hover { background: #f1f1f1; }

        /* åˆ—è¡¨æ¨£å¼ */
        .site-container { display: flex; flex-wrap: wrap; gap: 8px; padding: 10px 0; }
        .search-item input { display: none; }
        .search-item { 
            display: flex; align-items: center; padding: 8px 16px; 
            background: #fff; border-radius: 10px; cursor: pointer; 
            border: 1px solid #ddd; transition: all 0.15s ease; 
            user-select: none; color: #4b4f56; font-weight: 500; font-size: 14px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .search-item.active { 
            background: #9dd2f3; color: #fff; border-color: #9dd2f3;
            box-shadow: 0 2px 8px rgba(29,161,242,0.3);
        }
    </style>
</head>
<body>

    <div class="main-container">
        <div class="header">
            <div class="top-row">
                <div class="time-group">
                    <button class="btn-time" onclick="setTime(1, this)">1D</button>
                    <button class="btn-time active" onclick="setTime(7, this)">7D</button>
                    <button class="btn-time" onclick="setTime(30, this)">30D</button>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-outline" onclick="toggleAll()">å…¨é¸/æ¸…ç©º</button>
                    <button class="btn btn-primary" onclick="startMultiSearch()">é–‹å•Ÿé¸å–</button>
                </div>
            </div>
        </div>

        <div id="content" class="site-container">
            <div style="color:#888; font-style:italic;">é€£ç·šä¸­...</div>
        </div>
    </div>

    <script>
        const spreadsheetId = "1derDn2oXg3-NbMNoVtLwvye466dophZVOgrDID-rlbg";
        const sheetName = "Twitter-Search"; 
        let searchData = [];
        let selectedDays = 7; // é è¨­ 7 å¤©

        function getSinceDate(days) {
            if (days === null) return ""; 
            const d = new Date();
            d.setDate(d.getDate() - days);
            return d.toISOString().split('T')[0];
        }

        // åˆ‡æ›æ™‚é–“è¨­å®šï¼Œè‹¥é»æ“Šå·²é¸ä¸­çš„æŒ‰éˆ•å‰‡å–æ¶ˆé¸å–ï¼ˆä¸é™æ™‚ï¼‰
        function setTime(days, btn) {
            if (selectedDays === days) {
                selectedDays = null;
                btn.classList.remove('active');
            } else {
                selectedDays = days;
                document.querySelectorAll('.btn-time').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }
        }

        async function init() {
            const url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;
            try {
                const res = await fetch(url);
                const text = await res.text();
                const rows = text.split(/\r?\n/).map(row => row.trim().replace(/^"|"$/g, '')).filter(Boolean);

                const container = document.getElementById('content');
                container.innerHTML = "";

                rows.forEach((row, i) => {
                    const cols = row.split(',').map(c => c.trim().replace(/^"|"$/g, ''));
                    if (cols.length < 1) return;

                    const title = cols[0];
                    const query = cols[1] || cols[0];
                    searchData.push({ id: i, title, query });

                    const label = document.createElement('label');
                    label.className = 'search-item active';
                    label.innerHTML = `<input type="checkbox" value="${i}" checked><span>${title}</span>`;
                    label.onclick = (e) => {
                        const cb = label.querySelector('input');
                        cb.checked = !cb.checked;
                        label.classList.toggle('active', cb.checked);
                        e.preventDefault(); 
                    };
                    container.appendChild(label);
                });
            } catch (err) {
                document.getElementById('content').innerHTML = "è¼‰å…¥å¤±æ•—";
            }
        }

        function toggleAll() {
            const items = document.querySelectorAll('.search-item');
            const someUnchecked = Array.from(items).some(item => !item.querySelector('input').checked);
            items.forEach(item => {
                const cb = item.querySelector('input');
                cb.checked = someUnchecked;
                item.classList.toggle('active', someUnchecked);
            });
        }

        async function startMultiSearch() {
            const selectedIdx = Array.from(document.querySelectorAll('.search-item input:checked')).map(cb => cb.value);
            if (selectedIdx.length === 0) return alert("è«‹å…ˆé¸å–é …ç›®");
            if (selectedIdx.length > 5 && !confirm(`å³å°‡é–‹å•Ÿ ${selectedIdx.length} å€‹åˆ†é ï¼Œç¢ºå®šå—ï¼Ÿ`)) return;

            const sinceDate = getSinceDate(selectedDays);
            const timeFilter = sinceDate ? ` since:${sinceDate}` : "";

            for (let i = 0; i < selectedIdx.length; i++) {
                const data = searchData[selectedIdx[i]];
                const finalQuery = data.query + timeFilter;
                const url = `https://x.com/search?q=${encodeURIComponent(finalQuery)}&f=live`;
                window.open(url, '_blank');

                if (i < selectedIdx.length - 1) await new Promise(r => setTimeout(r, 800));
            }
        }

        init();
    </script>
</body>
</html>
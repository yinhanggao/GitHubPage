<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğ•-Search</title>
    <style>
        body { font-family: -apple-system, sans-serif; margin: 0; padding: 20px 0; background: #f0f2f5; color: #333; display: flex; justify-content: center; }
        .main-container { width: 95%; max-width: 450px; display: flex; flex-direction: column; }

        /* é ‚éƒ¨æ§åˆ¶æ¬„ */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; position: sticky; top: 0; background: #f0f2f5; padding: 10px 0; z-index: 100; border-bottom: 2px solid #ddd; }
        h1 { font-size: 18px; margin: 0; color: #1c1e21; }
        
        .button-group { display: flex; gap: 8px; }
        .btn { padding: 8px 15px; font-size: 13px; cursor: pointer; border-radius: 6px; font-weight: bold; border: 1px solid #ccc; transition: 0.2s; }
        
        .btn-primary { background: #1da1f2; color: white; border: none; }
        .btn-primary:hover { background: #1991db; }
        .btn-outline { background: #fff; color: #555; }
        .btn-outline:hover { background: #f1f1f1; }

        /* åˆ—è¡¨æ¨£å¼ */
        .site-container { display: flex; flex-wrap: wrap; gap: 8px; padding: 10px 0; }
        
        /* éš±è— Checkbox */
        .search-item input { display: none; }

        /* æ¨™ç±¤æ¨£å¼ (æœªé¸ä¸­) */
        .search-item { 
            display: flex; align-items: center; padding: 8px 16px; 
            background: #fff; border-radius: 10px; cursor: pointer; 
            border: 1px solid #ddd; transition: all 0.15s ease; 
            user-select: none; color: #4b4f56; font-weight: 500; font-size: 14px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        /* æ¨™ç±¤æ¨£å¼ (é¸ä¸­åç™½) */
        .search-item.active { 
            background: #1da1f2; 
            color: #fff; 
            border-color: #1da1f2;
            box-shadow: 0 2px 8px rgba(29,161,242,0.3);
        }

        .footer { font-size: 11px; color: #888; text-align: center; margin-top: 30px; }
    </style>
</head>
<body>

    <div class="main-container">
        <div class="header">
            <h1>ğ•</h1>
            <div class="button-group">
                <button class="btn btn-outline" onclick="toggleAll()">å…¨é¸/æ¸…ç©º</button>
                <button class="btn btn-primary" onclick="startMultiSearch()">é–‹å•Ÿé¸å–</button>
            </div>
        </div>

        <div id="content" class="site-container">
            <div style="color:#888; font-style:italic;">é€£ç·šä¸­...</div>
        </div>
    </div>

    <script>
        const spreadsheetId = "1derDn2oXg3-NbMNoVtLwvye466dophZVOgrDID-rlbg";
        const sheetName = "Twitter-Search"; 
        let searchData = [];

        async function init() {
            const url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;

            try {
                const res = await fetch(url);
                const text = await res.text();
                
                // è§£æ CSV ä¸¦éæ¿¾å¼•è™Ÿ
                const rows = text.split(/\r?\n/)
                                 .map(row => row.trim().replace(/^"|"$/g, ''))
                                 .filter(l => l !== "");

                const container = document.getElementById('content');
                container.innerHTML = "";

                rows.forEach((row, i) => {
                    const cols = row.split(',').map(c => c.trim().replace(/^"|"$/g, ''));
                    if (cols.length < 1) return;

                    const title = cols[0]; // åªå–ç¬¬ä¸€æ¬„é¡¯ç¤º
                    const query = cols[1] || cols[0]; // ç¬¬äºŒæ¬„æ˜¯æœå°‹æŒ‡ä»¤
                    
                    const item = { id: i, title, query };
                    searchData.push(item);

                    const label = document.createElement('label');
                    label.className = 'search-item active'; // é è¨­ç‚ºé¸ä¸­ç‹€æ…‹
                    label.innerHTML = `
                        <input type="checkbox" value="${i}" checked>
                        <span>${title}</span>
                    `;

                    label.onclick = (e) => {
                        const cb = label.querySelector('input');
                        cb.checked = !cb.checked;
                        label.classList.toggle('active', cb.checked);
                        e.preventDefault(); 
                    };

                    container.appendChild(label);
                });
            } catch (err) {
                console.error(err);
                document.getElementById('content').innerHTML = "è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–è©¦ç®—è¡¨åˆ†é åç¨±ã€‚";
            }
        }

        // å…¨é¸æˆ–å…¨éƒ¨å–æ¶ˆ
        function toggleAll() {
            const items = document.querySelectorAll('.search-item');
            const someUnchecked = Array.from(items).some(item => !item.querySelector('input').checked);
            items.forEach(item => {
                const cb = item.querySelector('input');
                cb.checked = someUnchecked;
                item.classList.toggle('active', someUnchecked);
            });
        }

        // åŸ·è¡Œæœå°‹ (å«å»¶é²æ©Ÿåˆ¶)
        async function startMultiSearch() {
            const selectedIdx = Array.from(document.querySelectorAll('.search-item input:checked'))
                                     .map(cb => cb.value);
            
            if (selectedIdx.length === 0) {
                alert("è«‹å…ˆé¸å–è¦æœå°‹çš„é …ç›®");
                return;
            }

            if (selectedIdx.length > 5 && !confirm(`å³å°‡é–‹å•Ÿ ${selectedIdx.length} å€‹åˆ†é ï¼Œç¢ºå®šå—ï¼Ÿ`)) return;

            for (let i = 0; i < selectedIdx.length; i++) {
                const data = searchData[selectedIdx[i]];
                const url = `https://x.com/search?q=${encodeURIComponent(data.query)}&f=live`;
                window.open(url, '_blank');

                // å»¶é² 800 æ¯«ç§’ï¼Œé¿å…è¢«ç€è¦½å™¨æ””æˆªå½ˆçª—
                if (i < selectedIdx.length - 1) {
                    await new Promise(r => setTimeout(r, 800));
                }
            }
        }

        init();
    </script>
</body>
</html>